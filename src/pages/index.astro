---
import { useStoryblokApi } from "@storyblok/astro";
import Header from "../components/Header.astro";
import Layout from "../layouts/Layout.astro";

const storyblokApi = useStoryblokApi();
const homeRes = await storyblokApi.get("cdn/stories/home", {
  version: import.meta.env.DEV ? "draft" : "published",
});

const postsRes = await storyblokApi.get("cdn/stories", {
  starts_with: "blog-posts/",
  version: import.meta.env.DEV ? "draft" : "published",
});

const stories = postsRes.data.stories;

const homeStory = homeRes.data.story;
---

<Layout title="Home">
  <main>
    <Header heading={homeStory.content.heading} />
    <ul>
      {
        stories.map((story: any) => (
          <li>
            <a href={`/my-blog/${story.slug}`}>{story.content.title}</a>
          </li>
        ))
      }
    </ul>
  </main>
</Layout>
